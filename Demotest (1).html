<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Crossy Road 2D ‚Äî Leaderboard</title>
  <style>
    :root{--bg:#87ceeb;--road:#333;--grass:#50c878;--player:#ffcc00;--car:#ff4444;--text:#111}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial;text-align:center;}
    canvas{background:var(--bg);box-shadow:0 10px 30px rgba(0,0,0,.2);border-radius:8px;display:block;margin:auto;}
    .controls button{margin:6px;padding:10px 16px;font-size:16px;border:none;border-radius:6px;background:#444;color:#fff;cursor:pointer;}
    .controls button:hover{background:#666;}
    .ui{position:fixed;left:12px;top:12px;color:var(--text)}
    .ui p{margin:4px 0;font-size:14px}
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ GAME OVER */
    #game-over-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    #game-over-screen h1 { margin-bottom: 5px; font-size: 40px; }
    #game-over-screen p { margin-top: 5px; font-size: 24px; }
    #leaderboard-list { 
        list-style: none; 
        padding: 0; 
        font-size: 18px; 
        margin-top: 20px;
        width: 250px;
        text-align: left;
    }
    #leaderboard-list li {
        background: #333;
        padding: 8px;
        margin-bottom: 4px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
    }
    #leaderboard-list .top-score { color: #ffcc00; font-weight: bold; }

  </style>
</head>
<body>
  <h2>Crossy Road 2D Game</h2>
  <canvas id="game" width="600" height="500"></canvas>
  <div class="ui">
    <p id="score">Score: 0</p>
    <p id="lives">Lives: 1</p>
  </div>
  <div class="controls">
    <button onclick="moveUp()">UP</button><br>
    <button onclick="moveLeft()">LEFT</button>
    <button onclick="moveRight()">RIGHT</button><br>
    <button onclick="moveDown()">DOWN</button>
  </div>
    
    <div id="game-over-screen">
        <h1>GAME OVER</h1>
        <p>Final Score: <span id="final-score">0</span></p>

        <h3>üèÜ TOP 5 SCORES üèÜ</h3>
        <ol id="leaderboard-list"></ol>

        <button onclick="startGame()" style="margin-top: 20px; padding: 10px 20px; font-size: 18px; background: #ffcc00; color: #333; border: none; border-radius: 6px; cursor: pointer;">
            START NEW GAME
        </button>
    </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    // DOM Elements
    const gameOverScreen = document.getElementById('game-over-screen');
    const finalScoreDisplay = document.getElementById('final-score');
    const leaderboardList = document.getElementById('leaderboard-list');

    const laneHeight = 80;
    const playerSize = 40;

    // --- GAME STATE VARIABLES ---
    // lives = 1: ‡πÇ‡∏î‡∏ô‡∏ä‡∏ô 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏Å‡∏°‡πÇ‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    // running = false ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å startGame()
    let score = 0, lives = 1, running = false; 
    let maxScoreY = H; 

    // Player Object
    const player = { x: W/2 - 20, y: H - 60, w: playerSize, h: playerSize, step: 10 }; 
    let cars = [];

    // --- LEADERBOARD FUNCTIONS ---
    function getLeaderboard() {
        const scores = localStorage.getItem('crossyRoadScores');
        return scores ? JSON.parse(scores) : [];
    }

    function saveScore(newScore) {
        const scores = getLeaderboard();
        scores.push(newScore);
        scores.sort((a, b) => b - a);
        const top5 = scores.slice(0, 5);
        localStorage.setItem('crossyRoadScores', JSON.stringify(top5));
        return top5;
    }

    function renderLeaderboard(scores, currentScore) {
        leaderboardList.innerHTML = '';
        scores.forEach((s, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>#${index + 1}</span>
                <span>${s}</span>
            `;
            if (s === currentScore && index < 5 && li.classList.length === 0) { 
                li.classList.add('top-score');
            }
            leaderboardList.appendChild(li);
        });
    }

    // --- GAME CONTROL FUNCTIONS ---
    
    function resetPlayer(){ 
        player.x = W/2 - 20; 
        player.y = H - 60; 
        maxScoreY = H; 
    }

    function spawnCars(){
        cars = [];
        for(let i=0; i < H/laneHeight; i++){
            const y = i * laneHeight;
            if(i > 0 && i < H/laneHeight - 1){ 
                for(let j=0;j<4;j++){ 
                    cars.push({
                        x: Math.random()*W, 
                        y, 
                        w:60, 
                        h:40, 
                        v:(Math.random()>0.5?1:-1)*(100 + Math.random()*100) 
                    });
                }
            }
        }
    }

    // ‚≠ê ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
    function startGame() {
        // ‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï score
        lives = 1; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
        running = true; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
        
        document.getElementById('score').textContent = 'Score: ' + score;
        document.getElementById('lives').textContent = 'Lives: ' + lives;
        
        resetPlayer(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
        spawnCars(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà
        
        gameOverScreen.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Game Over
        document.querySelectorAll('.controls button').forEach(btn => btn.disabled = false); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
        
        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏•‡∏π‡∏õ‡πÄ‡∏Å‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        if (!last) {
            last = performance.now();
            requestAnimationFrame(loop);
        }
    }

    function showGameOver() {
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        const topScores = saveScore(score);
        finalScoreDisplay.textContent = score;
        renderLeaderboard(topScores, score);
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏Å‡∏°
        gameOverScreen.style.display = 'flex';
        running = false;
        
        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
        document.querySelectorAll('.controls button').forEach(btn => btn.disabled = true);
    }

    function hit(){
      lives--; document.getElementById('lives').textContent='Lives: '+lives;
      if(lives<=0){
            showGameOver(); // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ GAME OVER
        } else {
            // ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ lives=1 ‡πÄ‡∏™‡∏°‡∏≠)
            resetPlayer();
        }
    }

    // --- GAME LOGIC ---

    function intersect(a,b){
      return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;
    }

    function update(dt){
      if(!running) return;
      
      for(const c of cars){
        c.x += c.v * dt;
        if(c.v>0 && c.x>W+80) c.x=-80;
        if(c.v<0 && c.x<-80) c.x=W+80;
        if(intersect(player,c)) hit();
      }
      
      // ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏ô
      if(player.y + player.h < maxScoreY - laneHeight){
          score++; 
          document.getElementById('score').textContent='Score: '+score;
          maxScoreY = player.y + player.h; 
      }

      // ‡∏´‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ä‡∏±‡∏¢ (‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏à‡∏≠)
      if(player.y <= 0){
          score++; 
          document.getElementById('score').textContent='Score: '+score; 
          resetPlayer();
      }
    }

    function draw(){
        if (!running) return; // ‡πÑ‡∏°‡πà‡∏ß‡∏≤‡∏î‡πÄ‡∏ü‡∏£‡∏°‡πÄ‡∏Å‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡∏à‡∏ö

        ctx.clearRect(0,0,W,H);

        // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ñ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏≤‡∏°‡∏´‡∏ç‡πâ‡∏≤
        for(let i=0;i<H/laneHeight;i++){
            ctx.fillStyle = (i%2===0)?'#333':'#50c878';
            ctx.fillRect(0,i*laneHeight,W,laneHeight);
        }

        // ‡∏ß‡∏≤‡∏î‡∏£‡∏ñ
        ctx.fillStyle='#ff4444';
        cars.forEach(c=>ctx.fillRect(c.x,c.y,c.w,c.h));

        // ‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏•‡∏Å (‡πÅ‡∏ó‡∏ô player ‡πÄ‡∏î‡∏¥‡∏°)
        const cx = player.x + player.w/2;
        const cy = player.y + player.h/2;
        const r = player.w/2;

        // ‡∏´‡∏ô‡πâ‡∏≤ (‡∏ß‡∏á‡∏Å‡∏•‡∏°)
        ctx.beginPath();
        ctx.fillStyle = '#ffcc00';
        ctx.arc(cx, cy, r, 0, Math.PI*2);
        ctx.fill();

        // ‡∏ï‡∏≤
        ctx.beginPath();
        ctx.fillStyle = '#000';
        ctx.arc(cx - r/3, cy - r/3, r/6, 0, Math.PI*2);
        ctx.arc(cx + r/3, cy - r/3, r/6, 0, Math.PI*2);
        ctx.fill();

        // ‡∏à‡∏°‡∏π‡∏Å (‡∏™‡∏µ‡πÅ‡∏î‡∏á)
        ctx.beginPath();
        ctx.fillStyle = '#ff0000';
        ctx.arc(cx, cy, r/5, 0, Math.PI*2);
        ctx.fill();

        // ‡∏õ‡∏≤‡∏Å (‡πÇ‡∏Ñ‡πâ‡∏á‡∏¢‡∏¥‡πâ‡∏°)
        ctx.beginPath();
        ctx.strokeStyle = '#cc0000';
        ctx.lineWidth = 3;
        ctx.arc(cx, cy + r/4, r/2.5, 0, Math.PI, false);
        ctx.stroke();
    }


    // --- GAME LOOP ---
    
    let last = 0; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤

    function loop(t){
        if (!running) {
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡∏à‡∏ö (running=false) ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï last ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì dt ‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            last = t; 
            // ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å requestAnimationFrame ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö startGame()
            requestAnimationFrame(loop); 
            return;
        }
        const dt=(t-last)/1000; last=t;
        update(dt); 
        draw();
        requestAnimationFrame(loop);
    }
    
    // ‚≠ê ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    startGame();


    // === Button Movement Functions ===
    function moveUp(){ if(!running) return; player.y -= player.step; limitPlayer(); }
    function moveDown(){ if(!running) return; player.y += player.step; limitPlayer(); }
    function moveLeft(){ if(!running) return; player.x -= player.step; limitPlayer(); }
    function moveRight(){ if(!running) return; player.x += player.step; limitPlayer(); }

    function limitPlayer(){
      if(player.x < 0) player.x = 0;
      if(player.x + player.w > W) player.x = W - player.w;
      if(player.y < 0) player.y = 0;
      if(player.y + player.h > H) player.y = H - player.h;
    }
    
    // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏®‡∏£
    document.addEventListener('keydown', (e) => {
        if (!running) return;
        switch(e.key) {
            case 'ArrowUp':
            case 'w':
                moveUp();
                break;
            case 'ArrowDown':
            case 's':
                moveDown();
                break;
            case 'ArrowLeft':
            case 'a':
                moveLeft();
                break;
            case 'ArrowRight':
            case 'd':
                moveRight();
                break;
        }
    });
  </script>
</body>
</html>